<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <!-- jQuery library -->
    <script src="asset/js/jquery-3.6.4.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- Image and text -->
      <nav id="navbar" class="navbar navbar-light bg-light">
        <a id="navbar-container" class="navbar-brand" href="#">
          <img
            id="navbar-image"
            src="/docs/4.0/assets/brand/bootstrap-solid.svg"
            width="30"
            height="30"
            class="d-inline-block align-top"
            alt=""
          />
          Bootstrap
        </a>
      </nav>

      <form
        id="loginForm"
        style="
          width: 200px;
          margin: 10px;
          padding: 10px;
          border-radius: 4px;
          border: 1px solid black;
        "
        action="javascript:void(0);"
      >
        <div class="mb-3">
          <label class="form-label" for="username">username</label>
          <input class="form-control" type="text" id="email" />
        </div>
        <div class="mb-3">
          <label class="form-label" for="password">password</label>
          <input class="form-control" type="password" id="password" />
        </div>
        <br />
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </body>
  <script>
    var username;
    var image;
    $(document).ready(function () {
      $("#navbar").hide();
      var loginForm = $("#loginForm");

      loginForm.submit(() => {
        var email = $("#email").val();
        var password = $("#password").val();
        var loginDto = new Object();
        loginDto.email = email;
        loginDto.password = password;
        loginDto.confirmpassword = password;
        $.ajax({
          url: "http://localhost:8080/auth/login",
          method: "POST",
          crossDomain: true,
          dataType: "json",
          data: JSON.stringify({
            email,
            password,
            confirmpassword: password,
          }),
          contentType: "application/json",
          success: function (result, status, jqXHR) {
            console.log(result);
            setuplogin(result);
          },
          error(jqXHR, textStatus, errorThrown) {},
        });
      });

      function setuplogin(data) {
        localStorage.setItem("accessTokent", data.data.accessToken);
        loginForm.hide();
        $.ajax({
          url: "http://localhost:8080/auth/getUserInfoByToken",
          method: "POST",
          crossDomain: true,
          dataType: "json",
          headers: {
            Authorization: data.data.accessToken,
          },
          contentType: "application/json",
          success: function (result, status, jqXHR) {
            console.log(result);
            username = result.data.name;
            image = result.data.imageUrl;

            loadNavbar(username, image);
          },
          error(jqXHR, textStatus, errorThrown) {},
        });
      }

      function loadNavbar(username, image) {
        $("#navbar").show();
        $("#navbar-container").text(username);
        $("#navbar-image").attr("src", image);
      }
    });
  </script>
  <!-- "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --profile-directory="Profile 22" --disable-web-security --disable-gpu --user-data-dir="D:\chromeTemp" -->
</html>
